<div class="veiculo-list-container">
  <div class="header">
    <h2>Lista de Veículos</h2>
    @if (canCreate()) {
      <button class="btn btn-primary" (click)="createItem()">
        Novo Veículo
      </button>
    }
  </div>

  <!-- Filtros -->
  <div class="filters">
    <div class="filter-group">
      <input 
        type="text" 
        placeholder="Filtrar por descrição"
        [(ngModel)]="descricaoFilter"
        (input)="onFilterChange()"
        class="form-control"
      >
    </div>
    <div class="filter-group">
      <input 
        type="text" 
        placeholder="Filtrar por placa"
        [(ngModel)]="placaFilter"
        (input)="onFilterChange()"
        class="form-control"
      >
    </div>
    <div class="filter-group">
      <input 
        type="number" 
        placeholder="Filtrar por ano"
        [(ngModel)]="anoFilter"
        (input)="onFilterChange()"
        class="form-control"
      >
    </div>
    <button class="btn btn-secondary" (click)="clearFilters()">
      Limpar Filtros
    </button>
  </div>

  <!-- Loading -->
  @if (loading) {
    <div class="loading">
      Carregando veículos...
    </div>
  }

  <!-- Error -->
  @if (error) {
    <div class="alert alert-error">
      {{ error }}
    </div>
  }

  <!-- Tabela de veículos -->
  @if (!loading && !error) {
    <div class="table-container">
    <table class="veiculos-table">
      <thead>
        <tr>
          <th>Descrição</th>
          <th>Placa</th>
          <th>Ano</th>
          <th>Marca</th>
          <th>Modelo</th>
          <th>Combustível</th>
          <th>Criado em</th>
          <th>Ações</th>
        </tr>
      </thead>
      <tbody>
  <tr *ngFor="let item of items">
          <td>{{ item.descricao }}</td>
          <td>{{ item.placa }}</td>
          <td>{{ item.ano }}</td>
          <td>{{ item.marca }}</td>
          <td>{{ item.modelo }}</td>
          <td>{{ item.combustivel }}</td>
          <td>{{ item.criadoEm | date:'dd/MM/yyyy HH:mm' }}</td>
          <td>
            @if (canEdit()) {
              <button class="btn btn-small btn-primary" (click)="editItem(item)">
                Editar
              </button>
            }
            @if (canDelete()) {
              <button class="btn btn-small btn-danger" (click)="deleteVehicle(item)">
                Excluir
              </button>
            }
            @if (canAudit()) {
              <button class="btn btn-small btn-audit" (click)="openAuditHistory(item)">
                Auditoria
              </button>
            }
          </td>
        </tr>
      </tbody>
    </table>

    <!-- Mensagem quando não há veículos -->
  @if (items.length === 0) {
      <div class="no-veiculos">
        Nenhum veículo encontrado.
      </div>
    }
  </div>
  }

  <!-- Paginação -->
  @if (totalPages > 1) {
    <div class="pagination">
    <button 
      class="btn btn-secondary" 
      (click)="onPageChange(currentPage - 1)"
      [disabled]="currentPage <= 1"
    >
      Anterior
    </button>
    
    <span class="page-info">
      Página {{ currentPage }} de {{ totalPages }} 
      ({{ totalItems }} veículos)
    </span>
    
    <button 
      class="btn btn-secondary" 
      (click)="onPageChange(currentPage + 1)"
      [disabled]="currentPage >= totalPages"
    >
      Próxima
    </button>
    </div>
  }
</div>

<!-- Modal de confirmação de exclusão -->
<app-confirmation-modal
  [isVisible]="showDeleteModal"
  [title]="deleteModalTitle"
  [message]="deleteModalMessage"
  confirmText="Excluir"
  cancelText="Cancelar"
  (confirmed)="onDeleteConfirmed()"
  (cancelled)="onDeleteCancelled()"
></app-confirmation-modal>

<!-- Modal de histórico de auditoria -->
<app-historico-auditoria
  *ngIf="selectedItemForAudit"
  [entidade]="'veiculos'"
  [entidadeId]="selectedItemForAudit.id"
  [entityDisplayName]="'Veículo'"
  [fieldLabels]="{
    descricao: 'Descrição',
    placa: 'Placa',
    ano: 'Ano',
    chassi: 'Chassi',
    marca: 'Marca',
    modelo: 'Modelo',
    combustivel: 'Combustível'
  }"
  [showModal]="showAuditModal"
  (modalClosed)="closeAuditModal()">
</app-historico-auditoria>
