@if (currentUser) {
<nav class="sidebar">
  <!-- Campo de pesquisa -->
  <div class="search-section" [class.filter-active]="isFilterActive">
    <div class="search-container">
      <div class="search-input-wrapper">
        <svg class="search-icon" width="20" height="20" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
          <circle cx="11" cy="11" r="8"></circle>
          <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
        </svg>
        <input 
          type="text" 
          class="search-input" 
          [class.filter-active]="isFilterActive"
          placeholder="Buscar menu..." 
          [(ngModel)]="searchQuery"
          (input)="onSearchInput($event)"
        />
        @if (searchQuery) {
          <button class="clear-search" (click)="clearSearch()">
            <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
              <line x1="18" y1="6" x2="6" y2="18"></line>
              <line x1="6" y1="6" x2="18" y2="18"></line>
            </svg>
          </button>
        }
      </div>
    </div>
  </div>

  <!-- Menu principal -->
  <div class="sidebar-content">
    <nav class="main-nav">
      @if (isFilterActive && getDisplayMenuItems().length === 0) {
        <div class="no-results-message">
          <svg width="48" height="48" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
            <circle cx="11" cy="11" r="8"></circle>
            <line x1="21" y1="21" x2="16.65" y2="16.65"></line>
          </svg>
          <p>Nenhum item encontrado</p>
          <span>Tente outro termo de busca</span>
        </div>
      }
      <ul class="nav-list">
        @for (item of getDisplayMenuItems(); track item.label) {
        <li class="nav-item">
          <!-- Item de menu normal -->
          @if (!item.isSubmenu) {
            <a 
              [routerLink]="item.route" 
              [class.active]="isRouteActive(item.route || '')"
              class="nav-link"
              [attr.title]="!shouldShowExpanded ? item.label : null"
              (click)="onMenuItemClick()"
            >
              <span class="nav-icon" [innerHTML]="getMenuIcon(item.icon)"></span>
              @if (shouldShowExpanded) {
                <span class="nav-text">{{ item.label }}</span>
              }
            </a>
          }
          
          <!-- Item de submenu -->
          @if (item.isSubmenu) {
            <div class="submenu-container">
              <button 
                class="nav-link submenu-toggle"
                [class.expanded]="isSubmenuExpanded(item.label)"
                (click)="toggleSubmenu(item.label)"
                [attr.title]="!shouldShowExpanded ? item.label : null"
              >
                <span class="nav-icon" [innerHTML]="getMenuIcon(item.icon)"></span>
                @if (shouldShowExpanded) {
                  <span class="nav-text">{{ item.label }}</span>
                  <span class="submenu-arrow" [class.rotated]="isSubmenuExpanded(item.label)">
                    <svg width="18" height="18" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                      <polyline points="6 9 12 15 18 9"></polyline>
                    </svg>
                  </span>
                }
              </button>
              
              <!-- Submenu items -->
              @if (isSubmenuExpanded(item.label) && shouldShowExpanded) {
                <ul class="submenu-list">
                  @for (subItem of item.submenuItems; track subItem.label) {
                    <li class="submenu-item">
                      @if (subItem.isSubmenu) {
                        <div class="submenu-container nested">
                          <button
                            class="submenu-link submenu-toggle"
                            [class.expanded]="isSubmenuExpanded(getSubmenuKey(item.label, subItem.label))"
                            (click)="toggleSubmenu(getSubmenuKey(item.label, subItem.label))"
                          >
                            <span class="submenu-icon" [innerHTML]="getMenuIcon(subItem.icon)"></span>
                            <span class="submenu-text">{{ subItem.label }}</span>
                            <span class="submenu-arrow" [class.rotated]="isSubmenuExpanded(getSubmenuKey(item.label, subItem.label))">
                              <svg width="16" height="16" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                                <polyline points="6 8 12 14 18 8"></polyline>
                              </svg>
                            </span>
                          </button>
                          @if (isSubmenuExpanded(getSubmenuKey(item.label, subItem.label))) {
                            <ul class="submenu-list nested-list">
                              @for (nestedItem of subItem.submenuItems; track nestedItem.label) {
                                <li class="submenu-item">
                                  <a 
                                    [routerLink]="nestedItem.route" 
                                    [class.active]="isRouteActive(nestedItem.route || '')"
                                    class="submenu-link"
                                    (click)="onMenuItemClick()"
                                  >
                                    <span class="submenu-icon" [innerHTML]="getMenuIcon(nestedItem.icon)"></span>
                                    <span class="submenu-text">{{ nestedItem.label }}</span>
                                  </a>
                                </li>
                              }
                            </ul>
                          }
                        </div>
                      } @else {
                        <a 
                          [routerLink]="subItem.route" 
                          [class.active]="isRouteActive(subItem.route || '')"
                          class="submenu-link"
                          (click)="onMenuItemClick()"
                        >
                          <span class="submenu-icon" [innerHTML]="getMenuIcon(subItem.icon)"></span>
                          <span class="submenu-text">{{ subItem.label }}</span>
                        </a>
                      }
                    </li>
                  }
                </ul>
              }
            </div>
          }
        </li>
        }
      </ul>
    </nav>
  </div>

</nav>
}