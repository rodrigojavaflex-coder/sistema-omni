{
  "version": 3,
  "sources": ["src/app/guards/auth.guard.ts", "src/app/app.routes.ts", "src/app/app.component.ts", "src/app/app.component.html", "src/app/interceptors/auth.interceptor.ts", "src/main.ts"],
  "sourcesContent": ["import { inject } from '@angular/core';\nimport { Router, CanActivateFn } from '@angular/router';\nimport { AuthService } from '../services/auth.service';\n\nexport const authGuard: CanActivateFn = async (route, state) => {\n  const authService = inject(AuthService);\n  const router = inject(Router);\n\n  if (authService.isAuthenticated()) {\n    const biometricEnabled = await authService.isBiometricEnabled();\n    if (!biometricEnabled) {\n      return true;\n    }\n\n    const unlocked = await authService.requireBiometricUnlock();\n    if (unlocked) {\n      return true;\n    }\n\n    await authService.lockSession();\n    router.navigate(['/login'], { queryParams: { returnUrl: state.url } });\n    return false;\n  }\n\n  router.navigate(['/login'], { queryParams: { returnUrl: state.url } });\n  return false;\n};\n", "import { Routes } from '@angular/router';\nimport { authGuard } from './guards/auth.guard';\n\nexport const routes: Routes = [\n  {\n    path: '',\n    redirectTo: '/login',\n    pathMatch: 'full'\n  },\n  {\n    path: 'login',\n    loadComponent: () => import('./pages/login/login.page').then(m => m.LoginPage)\n  },\n  {\n    path: 'home',\n    loadComponent: () => import('./pages/home/home.page').then(m => m.HomePage),\n    canActivate: [authGuard]\n  },\n  {\n    path: '**',\n    redirectTo: '/login'\n  }\n];\n", "import { Component, inject, CUSTOM_ELEMENTS_SCHEMA } from '@angular/core';\nimport { CommonModule } from '@angular/common';\nimport { Capacitor } from '@capacitor/core';\nimport {\n  AlertController,\n  IonApp,\n  IonButton,\n  IonContent,\n  IonHeader,\n  IonIcon,\n  IonItem,\n  IonList,\n  IonRouterOutlet,\n  IonTitle,\n  IonToggle,\n  IonToolbar,\n  ToastController\n} from '@ionic/angular/standalone';\nimport { addIcons } from 'ionicons';\nimport { logOutOutline } from 'ionicons/icons';\nimport { AuthService } from './services/auth.service';\nimport { Usuario } from './models/usuario.model';\n\n@Component({\n  selector: 'app-root',\n  templateUrl: 'app.component.html',\n  standalone: true,\n  styleUrls: ['app.component.scss'],\n  schemas: [CUSTOM_ELEMENTS_SCHEMA],\n  imports: [\n    CommonModule,\n    IonApp,\n    IonRouterOutlet,\n    IonHeader,\n    IonToolbar,\n    IonTitle,\n    IonContent,\n    IonList,\n    IonItem,\n    IonToggle,\n    IonButton,\n    IonIcon\n  ]\n})\nexport class AppComponent {\n  private authService = inject(AuthService);\n  private alertController = inject(AlertController);\n  private toastController = inject(ToastController);\n\n  user: Usuario | null = null;\n  isAuthenticated = false;\n  isNative = Capacitor.getPlatform() !== 'web';\n  biometricAvailable = false;\n  biometricEnabled = false;\n  biometricSaving = false;\n\n  constructor() {\n    addIcons({ logOutOutline });\n\n    this.authService.currentUser$.subscribe(user => {\n      this.user = user;\n    });\n\n    this.authService.isAuthenticated$.subscribe(isAuthenticated => {\n      this.isAuthenticated = isAuthenticated;\n      if (isAuthenticated) {\n        this.refreshBiometricState();\n      } else {\n        this.biometricAvailable = false;\n        this.biometricEnabled = false;\n      }\n    });\n  }\n\n  async logout(): Promise<void> {\n    await this.authService.logout();\n  }\n\n  async onBiometricToggle(event: CustomEvent): Promise<void> {\n    if (this.biometricSaving) {\n      return;\n    }\n\n    const shouldEnable = Boolean(event.detail?.checked);\n    if (!shouldEnable) {\n      this.biometricSaving = true;\n      await this.authService.disableBiometricLogin();\n      this.biometricEnabled = false;\n      this.biometricSaving = false;\n      return;\n    }\n\n    if (!this.user?.email) {\n      this.biometricEnabled = false;\n      await this.presentToast('Não foi possível identificar o usuário atual.');\n      return;\n    }\n\n    const alert = await this.alertController.create({\n      header: 'Ativar login por digital',\n      message: 'Confirme sua senha para habilitar o login por biometria.',\n      inputs: [\n        {\n          name: 'password',\n          type: 'password',\n          placeholder: 'Senha'\n        }\n      ],\n      buttons: [\n        {\n          text: 'Cancelar',\n          role: 'cancel'\n        },\n        {\n          text: 'Ativar',\n          role: 'confirm'\n        }\n      ]\n    });\n\n    await alert.present();\n    const { role, data } = await alert.onDidDismiss();\n    const password = data?.values?.password?.trim();\n    if (role !== 'confirm' || !password) {\n      this.biometricEnabled = false;\n      return;\n    }\n\n    this.biometricSaving = true;\n    const enabled = await this.authService.enableBiometricLogin(this.user.email, password);\n    this.biometricEnabled = enabled;\n    this.biometricSaving = false;\n\n    if (!enabled) {\n      await this.presentToast('Não foi possível ativar o login por biometria.');\n    }\n  }\n\n  private async refreshBiometricState(): Promise<void> {\n    this.biometricAvailable = await this.authService.isBiometricAvailable();\n    this.biometricEnabled = await this.authService.isBiometricEnabled();\n  }\n\n  private async presentToast(message: string): Promise<void> {\n    const toast = await this.toastController.create({\n      message,\n      duration: 2500,\n      color: 'danger',\n      position: 'top'\n    });\n    await toast.present();\n  }\n}\n", "<ion-app>\n  <ion-menu *ngIf=\"isAuthenticated && isNative\" content-id=\"main-content\">\n    <ion-header>\n      <ion-toolbar>\n        <ion-title>Configurações</ion-title>\n      </ion-toolbar>\n    </ion-header>\n    <ion-content class=\"menu-content\">\n      <ion-list class=\"menu-list\">\n        <ion-item lines=\"none\">\n          <ion-toggle\n            aria-label=\"Login por digital\"\n            [checked]=\"biometricEnabled\"\n            [disabled]=\"!biometricAvailable || biometricSaving\"\n            (ionChange)=\"onBiometricToggle($event)\">\n            Login por digital\n          </ion-toggle>\n        </ion-item>\n      </ion-list>\n      <div class=\"menu-footer\">\n        <ion-button\n          expand=\"block\"\n          color=\"danger\"\n          (click)=\"logout()\">\n          <ion-icon name=\"log-out-outline\" slot=\"start\"></ion-icon>\n          Sair\n        </ion-button>\n      </div>\n    </ion-content>\n  </ion-menu>\n\n  <ion-router-outlet id=\"main-content\"></ion-router-outlet>\n</ion-app>\n", "import { HttpInterceptorFn, HttpErrorResponse } from '@angular/common/http';\nimport { inject } from '@angular/core';\nimport { Router } from '@angular/router';\nimport { catchError, switchMap, throwError, from } from 'rxjs';\nimport { AuthService } from '../services/auth.service';\n\nexport const authInterceptor: HttpInterceptorFn = (req, next) => {\n  const authService = inject(AuthService);\n  const router = inject(Router);\n\n  // Não interceptar requisições de login/refresh\n  if (req.url.includes('/auth/login') || req.url.includes('/auth/refresh')) {\n    return next(req);\n  }\n\n  return from(authService.getAccessToken()).pipe(\n    switchMap(token => {\n      if (token) {\n        req = req.clone({\n          setHeaders: {\n            Authorization: `Bearer ${token}`\n          }\n        });\n      }\n\n      return next(req).pipe(\n        catchError((error: HttpErrorResponse) => {\n          if (error.status === 401) {\n            // Token expirado, tentar refresh\n            return from(authService.refreshAccessToken()).pipe(\n              switchMap(newToken => {\n                if (newToken) {\n                  // Retentar requisição com novo token\n                  const newReq = req.clone({\n                    setHeaders: {\n                      Authorization: `Bearer ${newToken}`\n                    }\n                  });\n                  return next(newReq);\n                } else {\n                  // Refresh falhou, fazer logout\n                  authService.logout();\n                  return throwError(() => error);\n                }\n              }),\n              catchError(() => {\n                  authService.logout();\n                  return throwError(() => error);\n              })\n            );\n          }\n          return throwError(() => error);\n        })\n      );\n    })\n  );\n};\n", "import { bootstrapApplication } from '@angular/platform-browser';\nimport { provideRouter } from '@angular/router';\nimport { provideHttpClient, withInterceptors } from '@angular/common/http';\nimport { provideIonicAngular } from '@ionic/angular/standalone';\nimport { routes } from './app/app.routes';\nimport { AppComponent } from './app/app.component';\nimport { authInterceptor } from './app/interceptors/auth.interceptor';\n\nbootstrapApplication(AppComponent, {\n  providers: [\n    provideRouter(routes),\n    provideHttpClient(withInterceptors([authInterceptor])),\n    provideIonicAngular({\n      mode: 'md' // ou 'ios' dependendo do seu caso\n    })\n  ]\n}).catch(err => console.error(err));\n"],
  "mappings": "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",
  "names": []
}
