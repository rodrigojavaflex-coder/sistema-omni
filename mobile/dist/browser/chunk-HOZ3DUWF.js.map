{
  "version": 3,
  "sources": ["src/app/services/vistoria.service.ts", "src/app/services/vistoria-flow.service.ts"],
  "sourcesContent": ["import { Injectable, inject } from '@angular/core';\r\nimport { HttpClient } from '@angular/common/http';\r\nimport { firstValueFrom } from 'rxjs';\r\nimport { environment } from '../../environments/environment';\r\nimport { Capacitor } from '@capacitor/core';\r\nimport {\r\n  ChecklistItemPayload,\r\n  ChecklistImagemResumo,\r\n  ChecklistItemResumo,\r\n  Vistoria,\r\n} from '../models/vistoria.model';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class VistoriaService {\r\n  private http = inject(HttpClient);\r\n  private apiBaseUrl = Capacitor.getPlatform() !== 'web'\r\n    ? environment.apiUrlNative || environment.apiUrl\r\n    : environment.apiUrl;\r\n\r\n  async iniciarVistoria(payload: {\r\n    idusuario: string;\r\n    idveiculo: string;\r\n    idmotorista: string;\r\n    odometro: number;\r\n    porcentagembateria?: number;\r\n    idtipovistoria: string;\r\n    datavistoria: string;\r\n  }): Promise<Vistoria> {\r\n    return firstValueFrom(\r\n      this.http.post<Vistoria>(`${this.apiBaseUrl}/vistoria`, payload),\r\n    );\r\n  }\r\n\r\n  async atualizarVistoria(\r\n    vistoriaId: string,\r\n    payload: {\r\n      idveiculo?: string;\r\n      idmotorista?: string;\r\n      idtipovistoria?: string;\r\n      odometro?: number;\r\n      porcentagembateria?: number | null;\r\n      datavistoria?: string;\r\n    },\r\n  ): Promise<Vistoria> {\r\n    return firstValueFrom(\r\n      this.http.patch<Vistoria>(`${this.apiBaseUrl}/vistoria/${vistoriaId}`, payload),\r\n    );\r\n  }\r\n\r\n  async getById(vistoriaId: string): Promise<Vistoria> {\r\n    return firstValueFrom(\r\n      this.http.get<Vistoria>(`${this.apiBaseUrl}/vistoria/${vistoriaId}`),\r\n    );\r\n  }\r\n\r\n  async getUltimoOdometro(\r\n    idveiculo: string,\r\n    ignorarVistoriaId?: string,\r\n  ): Promise<{ odometro: number; datavistoria: string } | null> {\r\n    return firstValueFrom(\r\n      this.http.get<{ odometro: number; datavistoria: string } | null>(\r\n        `${this.apiBaseUrl}/vistoria/veiculo/${idveiculo}/ultimo-odometro`,\r\n        {\r\n          params: ignorarVistoriaId\r\n            ? { ignorarVistoriaId }\r\n            : {},\r\n        },\r\n      ),\r\n    );\r\n  }\r\n\r\n  async salvarChecklistItem(\r\n    vistoriaId: string,\r\n    payload: ChecklistItemPayload,\r\n  ): Promise<{ id: string }> {\r\n    return firstValueFrom(\r\n      this.http.post<{ id: string }>(\r\n        `${this.apiBaseUrl}/vistoria/${vistoriaId}/checklist`,\r\n        payload,\r\n      ),\r\n    );\r\n  }\r\n\r\n  async uploadChecklistImagens(\r\n    vistoriaId: string,\r\n    checklistId: string,\r\n    files: { nomeArquivo: string; blob: Blob }[],\r\n  ): Promise<void> {\r\n    const formData = new FormData();\r\n    files.forEach((file) => {\r\n      formData.append('files', file.blob, file.nomeArquivo);\r\n    });\r\n    await firstValueFrom(\r\n      this.http.post<void>(\r\n        `${this.apiBaseUrl}/vistoria/${vistoriaId}/checklist/${checklistId}/imagens`,\r\n        formData,\r\n      ),\r\n    );\r\n  }\r\n\r\n  async listarChecklist(vistoriaId: string): Promise<ChecklistItemResumo[]> {\r\n    return firstValueFrom(\r\n      this.http.get<ChecklistItemResumo[]>(\r\n        `${this.apiBaseUrl}/vistoria/${vistoriaId}/checklist`,\r\n      ),\r\n    );\r\n  }\r\n\r\n  async listarChecklistImagens(\r\n    vistoriaId: string,\r\n  ): Promise<ChecklistImagemResumo[]> {\r\n    return firstValueFrom(\r\n      this.http.get<ChecklistImagemResumo[]>(\r\n        `${this.apiBaseUrl}/vistoria/${vistoriaId}/checklist/imagens`,\r\n      ),\r\n    );\r\n  }\r\n\r\n  async finalizarVistoria(\r\n    vistoriaId: string,\r\n    payload: { tempo: number; observacao?: string },\r\n  ): Promise<Vistoria> {\r\n    return firstValueFrom(\r\n      this.http.post<Vistoria>(\r\n        `${this.apiBaseUrl}/vistoria/${vistoriaId}/finalizar`,\r\n        payload,\r\n      ),\r\n    );\r\n  }\r\n\r\n  async cancelarVistoria(vistoriaId: string): Promise<Vistoria> {\r\n    return firstValueFrom(\r\n      this.http.post<Vistoria>(`${this.apiBaseUrl}/vistoria/${vistoriaId}/cancelar`, {}),\r\n    );\r\n  }\r\n\r\n  async retomarVistoria(vistoriaId: string): Promise<Vistoria> {\r\n    return firstValueFrom(\r\n      this.http.post<Vistoria>(`${this.apiBaseUrl}/vistoria/${vistoriaId}/retomar`, {}),\r\n    );\r\n  }\r\n\r\n  async listarEmAndamento(\r\n    idusuario?: string,\r\n    ignorarVistoriaId?: string,\r\n  ): Promise<Vistoria[]> {\r\n    return firstValueFrom(\r\n      this.http.get<Vistoria[]>(`${this.apiBaseUrl}/vistoria`, {\r\n        params: {\r\n          status: 'EM_ANDAMENTO',\r\n          ...(idusuario ? { idusuario } : {}),\r\n          ...(ignorarVistoriaId ? { ignorarVistoriaId } : {}),\r\n        },\r\n      }),\r\n    );\r\n  }\r\n}\r\n", "import { Injectable } from '@angular/core';\r\n\r\n@Injectable({ providedIn: 'root' })\r\nexport class VistoriaFlowService {\r\n  private vistoriaId: string | null = null;\r\n  private tipoVistoriaId: string | null = null;\r\n  private startedAt: number | null = null;\r\n  private veiculoDescricao: string | null = null;\r\n  private tipoVistoriaDescricao: string | null = null;\r\n  private dataVistoriaIso: string | null = null;\r\n\r\n  iniciar(\r\n    vistoriaId: string,\r\n    tipoVistoriaId: string,\r\n    options?: { veiculoDescricao?: string; tipoVistoriaDescricao?: string; datavistoria?: string },\r\n  ): void {\r\n    this.vistoriaId = vistoriaId;\r\n    this.tipoVistoriaId = tipoVistoriaId;\r\n    this.startedAt = Date.now();\r\n    this.veiculoDescricao = options?.veiculoDescricao ?? this.veiculoDescricao;\r\n    this.tipoVistoriaDescricao = options?.tipoVistoriaDescricao ?? this.tipoVistoriaDescricao;\r\n    this.dataVistoriaIso = options?.datavistoria ?? this.dataVistoriaIso;\r\n  }\r\n\r\n  finalizar(): void {\r\n    this.vistoriaId = null;\r\n    this.tipoVistoriaId = null;\r\n    this.startedAt = null;\r\n    this.veiculoDescricao = null;\r\n    this.tipoVistoriaDescricao = null;\r\n    this.dataVistoriaIso = null;\r\n  }\r\n\r\n  getVistoriaId(): string | null {\r\n    return this.vistoriaId;\r\n  }\r\n\r\n  getTipoVistoriaId(): string | null {\r\n    return this.tipoVistoriaId;\r\n  }\r\n\r\n  updateContext(options: {\r\n    tipoVistoriaId?: string;\r\n    veiculoDescricao?: string;\r\n    tipoVistoriaDescricao?: string;\r\n    datavistoria?: string;\r\n  }): void {\r\n    if (options.tipoVistoriaId) {\r\n      this.tipoVistoriaId = options.tipoVistoriaId;\r\n    }\r\n    if (options.veiculoDescricao !== undefined) {\r\n      this.veiculoDescricao = options.veiculoDescricao;\r\n    }\r\n    if (options.tipoVistoriaDescricao !== undefined) {\r\n      this.tipoVistoriaDescricao = options.tipoVistoriaDescricao;\r\n    }\r\n    if (options.datavistoria !== undefined) {\r\n      this.dataVistoriaIso = options.datavistoria;\r\n    }\r\n  }\r\n\r\n  getVeiculoDescricao(): string | null {\r\n    return this.veiculoDescricao;\r\n  }\r\n\r\n  getTipoVistoriaDescricao(): string | null {\r\n    return this.tipoVistoriaDescricao;\r\n  }\r\n\r\n  getDataVistoriaIso(): string | null {\r\n    return this.dataVistoriaIso;\r\n  }\r\n\r\n  getTempoEmMinutos(): number {\r\n    if (!this.startedAt) {\r\n      return 0;\r\n    }\r\n    const diffMs = Date.now() - this.startedAt;\r\n    return Math.max(1, Math.round(diffMs / 60000));\r\n  }\r\n}\r\n"],
  "mappings": "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",
  "names": []
}
